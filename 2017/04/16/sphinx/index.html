






<!doctype html>
<html lang="">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  
  
    <meta name="description" content="中文分词  中文分词(Chinese Word Segmentation) 
  指的是将一个汉字序列切分成一个一个单独的词。分词就是将连续的字序列按照一定的规范  重新组合成词序列的过程。我们知道，在英文的行文中，单词之间是以空格作为自然分界符  的，而中文只是字、句和段能通过明显的分界符来简单划界，唯独词没有一个形式上的分  界符，虽然英文也同样存在短语的划分问题，不过在词这一层上，中文...">
  
  <title>sphinx [ when ]</title>
  
  
    <link rel="shortcut icon" href="/when.ico">
  
  
  <link rel="stylesheet" href="/css/random.css">
<link rel="stylesheet" href="/css/vegas.min.css">
<link rel="stylesheet" href="/css/highlight-railscasts.css">
<link rel="stylesheet" href="/css/jquery.fancybox.css">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/jquery.fancybox-thumbs.css">
<link rel="stylesheet" href="/css/plyr.css">
  
</head>

<body>
<div class="side-navigate hide-area">
  
    <div class="item prev">
      <a href="/2016/04/03/code-phpstorm/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        Phpstorm 激活
      </div>
    </div>
  
  
    <div class="item next">
      <a href="/2017/04/20/rwseparate/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        框架中读写分离的实现
      </div>
    </div>
  
</div>
<div id="outer-container" class="hide-area">
<div id="container">
  <div id="menu-outer" class="slide-down">
    <div id="menu-inner">
      <div id="brand">
        
        <a onClick="openUserCard()">
          <img id="avatar" src="http://om34v8mq1.bkt.clouddn.com/head.png"/>
          <div id="homelink">when</div>
        </a>
      </div>
      <div id="menu-list">
        <ul>
        
        
          
            <li>
          
            <a href="/index.html">Home</a>
            
          </li>
        
          
            <li>
          
            <a href="/archives">Archives</a>
            
          </li>
        
          
            <li>
          
            <a href="/tags">Tags</a>
            
          </li>
        
        </ul>
      </div>
      <div id="show-menu">
        <button>Menu</button>
      </div>
    </div>
  </div>

  <div id="content-outer">
    <div id="content-inner">
      
      
  <article id="post">
    <h1>sphinx</h1>
    <p class="page-title-sub">
      <span id = "post-title-date">撰写于 2017-04-16</span>
      
        <span id = "post-title-updated">修改于 2017-04-24</span>
      
      
      
      <span id = "post-title-tags">
      标签
      
      
        
        
        <a href="/tags/PHP/">PHP</a>
      
      </span>
      
    </p>
    
    <h1 id="中文分词"><a href="#中文分词" class="headerlink" title="中文分词"></a>中文分词</h1><p>  中文分词(Chinese Word Segmentation) </p>
<p>  指的是将一个汉字序列切分成一个一个单独的词。分词就是将连续的字序列按照一定的规范<br>  重新组合成词序列的过程。我们知道，在英文的行文中，单词之间是以空格作为自然分界符<br>  的，而中文只是字、句和段能通过明显的分界符来简单划界，唯独词没有一个形式上的分<br>  界符，虽然英文也同样存在短语的划分问题，不过在词这一层上，中文比之英文要复杂的<br> 多、困难的多。<br>  <img src="http://img2.tuicool.com/Ab2U7b.jpg" alt="image"></p>
<h2 id="1-1-什么是CoreSeek-Sphinx"><a href="#1-1-什么是CoreSeek-Sphinx" class="headerlink" title="1.1. 什么是CoreSeek/Sphinx"></a>1.1. 什么是CoreSeek/Sphinx</h2><p>Sphinx是一个在GPLv2下分发的全文检索引擎；Coreseek 是一个可供企业使用的、基于Sphinx（可独立于Sphinx原始版本运行）的中文全文检索引擎，按照GPLv2协议发行。商业使用（例如, 嵌入到其他程序中）需要联系我们以获得商业授权。</p>
<p>一般而言，Sphinx是一个独立的全文搜索引擎；而Coreseek是一个支持中文的全文搜索引擎，意图为其他应用提供高速、低空间占用、高相关度结果的中文全文搜索能力。CoreSeek/Sphinx可以非常容易的与SQL数据库和脚本语言集成。</p>
<p>应用程序可以通过三种不同的接口方式来与Sphinx搜索服务(searchd)通信： a) 通过原生的搜索 API (SphinxAPI), b) 通过Sphinx自身支持的MySQL网络协议 (使用命名为SphinxQL的SQL精简子集), 或者 c) 通过MySQL 服务端的存储插件引擎(SphinxSE)。当然， 还可以通过可以使用 a)、b)、c) 的应用程序来构建webservice来为其他应用程序提供通信</p>
<p>在Sphinx发行版本中提供的原生搜索API支持PHP、Python、Perl、Rudy和Java。搜索API非常轻量化，可以在几个小时之内移植到新的语言上。第三方API接口和插件提供了对Perl、C#、Haskell、Ruby-on-Rails支持，以及对其他可能的语言或者框架的支持。</p>
<p>从版本1.10-beta开始，Sphinx支持两种不同的索引后端：“磁盘（disk）”索引后端和“实时索引（realtime）”（RT）索引后端。磁盘索引支持在线全文索引重建，但是仅支持非文本（属性）数据的在线更新。RT实时索引在此基础上，又增加了在线的全文索引更新。在此之前的版本仅支持磁盘索引。</p>
<p>使用命名为数据源的接口，数据可以被加载到磁盘索引。当前系统内置MySQL和PostgreSQL以及ODBC兼容（MS SQL、Oracle等） 数据库数据源的支持，也支持从管道标准输入读取特定格式的XML数据。通过适当修改源代码，用户可以自行增加新的数据源驱动（例如：对其他类型的DBMS的原生支持）。在Coreseek发行的版本中，用户还可以使用Python脚本作为数据源来获取任何已知世界和未知世界的数据，这极大的扩展了数据源的来源。从1.10-beta版本开始的RT实时索引，只能使用MySQL接口通过SphinxQL来操作。</p>
<p>Sphinx 是SQL Phrase Index的缩写，但不幸的和CMU的Sphinx项目重名。</p>
<p>Coreseek (<a href="http://www.coreseek.cn/" target="_blank" rel="external">http://www.coreseek.cn/</a>) </p>
<h2 id="1-2-CoreSeek-Sphinx-的特性"><a href="#1-2-CoreSeek-Sphinx-的特性" class="headerlink" title="1.2. CoreSeek/Sphinx 的特性"></a>1.2. CoreSeek/Sphinx 的特性</h2><p>Sphinx 的主要特性：</p>
<p>索引和搜索性能优异；</p>
<p>先进的索引和查询工具(灵活且功能丰富的文本分析器，查询语言，以及多种不同的排序方式等等);</p>
<p>先进的结果集分析处理 (SELECT 可以使用表达式, WHERE, ORDER BY, GROUP BY<br>等对全文搜索结果集进行过滤)；</p>
<p>实践证实可扩展性支持数十亿文档记录，TB级别的数据，以及每秒数千次查询;</p>
<p>易于集成SQL和XML数据源，并可使用SphinxAPI、SphinxQL或者SphinxSE搜索接口</p>
<p>易于通过分布式搜索进行扩展</p>
<p>Sphinx 的详细特性：</p>
<p>高速的索引建立(在当代CPU上，峰值性能可达到10 ~ 15MB/秒);</p>
<p>高性能的搜索 (在1.2G文本，100万条文档上进行搜索，支持高达每秒150~250次查询);</p>
<p>高扩展性 (最大的索引集群超过30亿条文档，最繁忙时刻的查询峰值达到每天5千万次);</p>
<p>提供了优秀的相关度算法，基于短语相似度和统计（BM25）的复合Ranking方法;</p>
<p>支持分布式搜索功能;</p>
<p>提供文档片段（摘要以及高亮）生成功能;</p>
<p>内建支持SphinxAPI和SphinxQL搜索箭口，也可作为MySQL的存储引擎提供搜索服务;</p>
<p>支持布尔、短语、词语相似度等多种检索模式;</p>
<p>文档支持多个全文检索字段(缺省配置下，最大不超过32个);</p>
<p>文档支持多个额外的属性信息(例如：分组信息，时间戳等);</p>
<p>支持查询停止词;</p>
<p>支持词形学处理;</p>
<p>支持特殊词汇处理;</p>
<p>支持单一字节编码和UTF-8编码;</p>
<p>内建支持英语、俄语、捷克语词干化处理; 对 法语，西班牙语，葡萄牙语，意大利语，罗马尼亚语，德国，荷兰，瑞典，挪威，丹麦，芬兰，匈牙利等语言 的支持可通过第三方的 libstemmer 库 建立);</p>
<p>原生的MySQL支持(同时支持MyISAM 、InnoDB、NDB、Archive等所有类型的数据表 );</p>
<p>原生的PostgreSQL 支持;</p>
<p>原生的ODBC兼容数据库支持 (MS SQL, Oracle, 等) ;</p>
<p>…多达50多项其他功能没有在此一一列出，请参阅API和配置手册！</p>
<h2 id="1-3-为什么要使用Coreseek"><a href="#1-3-为什么要使用Coreseek" class="headerlink" title="1.3  为什么要使用Coreseek"></a>1.3  为什么要使用Coreseek</h2><pre><code>mysql在大量数据（100W+），以及无法命中索引的查询语句中性能 低下。 

Coreseek的查询性能非常高，可以快速的根据条件检索出符合条件的 

记录主键，然后我们可以根据这个主键快速的找到mysql中对应记录的 详细信息。 

可以提供高速、低空间占用、高相关度结果的中文全文检索。 Coreseek可以非常容易的与SQL数据库和脚本语言集成。 

支持分布式搜索扩展，通过在不同的服务器上对数据进行分片搜索， 提高性能
</code></pre><h2 id="1-4-那些地方适合使用Coreseek"><a href="#1-4-那些地方适合使用Coreseek" class="headerlink" title="1.4  那些地方适合使用Coreseek"></a>1.4  那些地方适合使用Coreseek</h2><p>①  当你的服务用户很多，经常会有大量查询请求，而又无法高效的返回 查询结果的时候</p>
<p>②  典型的应用有</p>
<p>1.关键词搜索。</p>
<pre><code>常用来用来搭建论坛和博客的内建检索引擎。 
</code></pre><p>2.关联搜索。<br>    即完全匹配的相关性条目进行关联展示。体验就像百度搜索框 的自动补全建议</p>
<p>3.相关词推荐。    </p>
<pre><code>这个跟关联搜索类似，但是通常出现在相关词推荐中。简单的 实现就是提取自己库的关键词作为一个数据源，然后在其中搜 索与查询词相关的词。体验就像百度搜索页底部的”相关搜索” 区域
</code></pre><h2 id="1-5-国内全文检索的几个典型应用场景。"><a href="#1-5-国内全文检索的几个典型应用场景。" class="headerlink" title="1.5  国内全文检索的几个典型应用场景。"></a>1.5  国内全文检索的几个典型应用场景。</h2><p>您在运营知识分享型的社区(Forum)：<br>    大量的新来用户对某些简单的问题反复发帖询问，版主不胜其烦；</p>
<pre><code>大量宝贵的答案、精辟的见解被淹没在回复中，通过帖子主题检索不到；

为了降低服务器负载，您不得不限制用户每30秒才能使用搜索功能一次，用户很难受，您很难过；

为了提高服务质量，您寄希望于Google、百度这样的全网搜索引擎，但是您的数据更新可能不及时， 

更要命的是有些私密的主题，您不想让除了您和您的注册用户以外的第三方知道
</code></pre><p>您在运营社会化社交网络（SNS）： </p>
<pre><code>如何让您的用户找到志同道合的朋友？

如何帮助用户更好的管理自己的Blog？
</code></pre><p>您在运营电子商务网站(e-Shop)：</p>
<pre><code>如何让每个访客尽快找到他/她感兴趣的商品，达成销售？
</code></pre><p>您每天需要处理大量的电子文档(CMS)：</p>
<pre><code>如何在最短的时间内找到您需要的文件

如何利用现有文件的内容加速您新文档的撰写工作
</code></pre><h2 id="1-6-哪些地方不适合Coreseek"><a href="#1-6-哪些地方不适合Coreseek" class="headerlink" title="1.6  哪些地方不适合Coreseek"></a>1.6  哪些地方不适合Coreseek</h2><pre><code>对查询效率无要求（不在乎性能，当然无需使用专门的检索引擎） 

对数据实时性要求很高的需求

数据经常变动（数据频繁变动，将会导致检索结果不准确，并且频繁 的重建主索引导致性能太低）
</code></pre><h2 id="1-7-Coreseek的局限性"><a href="#1-7-Coreseek的局限性" class="headerlink" title="1.7  Coreseek的局限性"></a>1.7  Coreseek的局限性</h2><pre><code>数据表必须有主键 

主键必须为非零整型 

不负责数据存储

配置不够灵活
</code></pre><p>本章节概述Coreseek安装说明, 具体环境及详细说明请见Coreseek官方中文手册: <a href="http://www.coreseek.cn/products-install/step_by_step/" target="_blank" rel="external">http://www.coreseek.cn/products-install/step_by_step/</a></p>
<h2 id="2-1-如何得到CoreSeek-Sphinx"><a href="#2-1-如何得到CoreSeek-Sphinx" class="headerlink" title="2.1. 如何得到CoreSeek/Sphinx"></a>2.1. 如何得到CoreSeek/Sphinx</h2><p>Sphinx原始版本可以从Sphinx官方网站 sphinxsearch.com/，Coreseek可以从Coreseek官方网站 www.coreseek.cn/下载。</p>
<p>目前，CoreSeek/Sphinx的发布包包括如下软件：</p>
<p>indexer: 用于创建全文索引;</p>
<p>search: 一个简单的命令行(CLI) 的测试程序，用于测试全文索引;</p>
<p>searchd: 一个守护进程，其他软件（例如WEB程序）可以通过这个守护进程进行全文检索;</p>
<p>sphinxapi: 一系列searchd 的客户端API 库，用于流行的Web脚本开发语言(PHP, Python, Perl, Ruby, Java).</p>
<p>spelldump: 一个简单的命令行工具，用于从 ispell 或者 MySpell (OpenOffice内置绑定) 格式的字典中提取词条。当使用 wordforms时可用这些词条对索引进行定制.</p>
<p>indextool: 工具程序，用来转储关于索引的多项调试信息。此工具是从版本Coreseek 3.1(Sphinx 0.9.9-rc2)开始加入的。</p>
<p>mmseg: 工具程序和库，Coreseek用于提供中文分词和词典处理。<br>以下使用MySQL数据源进行说明.</p>
<h2 id="2-2-去-官网-下载coreseek源码包，本文以-4-1为例"><a href="#2-2-去-官网-下载coreseek源码包，本文以-4-1为例" class="headerlink" title="2.2 去 官网 下载coreseek源码包，本文以 4.1为例"></a>2.2 去 官网 下载coreseek源码包，本文以 4.1为例</h2><pre><code>wget http://www.coreseek.cn/uploads/csft/4.0/coreseek-4.1-beta.tar.gz

tar zxvf coreseek-4.1-beta.tar.gz

cd coreseek-4.1-beta/mmseg-3.2.14

./bootstrap    #warning信息可以忽略，error信息则需要解决

./configure --prefix=/usr/local/mmseg3

make &amp;&amp; make install

cd ../
</code></pre><p>如果wget失败，可以通过ftp上传</p>
<p>如果上传失败，给目录赋予权限</p>
<pre><code>chmod  0777  /usr/local/src
</code></pre><p>下载链接：<a href="http://vdisk.weibo.com/s/z-JIj1kq4Z81" target="_blank" rel="external">http://vdisk.weibo.com/s/z-JIj1kq4Z81</a></p>
<h2 id="2-3-然后安装coreseek"><a href="#2-3-然后安装coreseek" class="headerlink" title="2.3  然后安装coreseek"></a>2.3  然后安装coreseek</h2><pre><code>yum -y install expat expat-devel
cd csft-3.2.14
sh buildconf.sh   #warning信息可以忽略，error信息需要解决
./configure --prefix=/usr/local/coreseek  --without-unixodbc --with-mmseg --with-mmseg-includes=/usr/local/mmseg3/include/mmseg/ --with-mmseg-libs=/usr/local/mmseg3/lib/ --with-mysql 
make &amp;&amp; make install
</code></pre><p>1./usr/local/coreseek/bin/indexer indexer文件，用于建立/更新/合并数据源的索引<br>2./usr/local/coreseek/bin/search search文件，用于测试数据源的搜索<br>3./usr/local/coreseek/bin/searchd searchd文件，负责接受查询、处理查询和返回数据集的服务<br>中间很有可能会出错，如果出错按如下方法处理 编辑： 打开./src/MakeFile 文件 将 </p>
<pre><code>LIBS=-lm-lexpat-L/usr/local/lib 
</code></pre><p>改成</p>
<pre><code>LIBS=-lm-lexpat-liconv-L/usr/local/lib
</code></pre><h2 id="2-4-安装mmseg"><a href="#2-4-安装mmseg" class="headerlink" title="2.4  安装mmseg"></a>2.4  安装mmseg</h2><h2 id="2-5-测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh-CN-UTF-8，确保正确显示中文）"><a href="#2-5-测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh-CN-UTF-8，确保正确显示中文）" class="headerlink" title="2.5  测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh_CN.UTF-8，确保正确显示中文）"></a>2.5  测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh_CN.UTF-8，确保正确显示中文）</h2><pre><code>cd testpack

cat var/test/test.xml    #此时应该正确显示中文

/usr/local/mmseg3/bin/mmseg -d /usr/local/mmseg3/etc var/test/test.xml

/usr/local/coreseek/bin/indexer -c etc/csft.conf --all

/usr/local/coreseek/bin/search -c etc/csft.conf 网络搜索
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">如果正常会显示如下</div><div class="line">words: </div><div class="line">1.&apos;网络&apos;:1documents,1hits </div><div class="line">2.&apos;搜索&apos;:2documents,5hits</div></pre></td></tr></table></figure>
<h2 id="3-1-配置测试，测试是否可以正确运行"><a href="#3-1-配置测试，测试是否可以正确运行" class="headerlink" title="3.1 配置测试，测试是否可以正确运行"></a>3.1 配置测试，测试是否可以正确运行</h2><pre><code>/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/sphinx-min.conf.dist
</code></pre><p>以下为正常测试时的提示信息：</p>
<pre><code> Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;/usr/local/coreseek/etc/sphinx-min.conf.dist&apos;...
total 0 reads, 0.000 sec, 0.0 kb/call avg, 0.0 msec/call avg
total 0 writes, 0.000 sec, 0.0 kb/call avg, 0.0 msec/call avg
</code></pre><p> 至此，coreseek基础环境可以正常安装，我们可以开始后续的工作啦。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">注意：基础环境仅支持xml数据源；如需要mysql或者python数据源，请继续按照下面的步骤操作！！！</div></pre></td></tr></table></figure>
<p>数据源支持：支持MySQL数据源</p>
<h2 id="3-2-重新编译安装coreseek，以支持mysql数据源和xml数据源"><a href="#3-2-重新编译安装coreseek，以支持mysql数据源和xml数据源" class="headerlink" title="3.2  重新编译安装coreseek，以支持mysql数据源和xml数据源"></a>3.2  重新编译安装coreseek，以支持mysql数据源和xml数据源</h2><pre><code>cd csft-3.2.14

make clean

./configure --prefix=/usr/local/coreseek  --without-unixodbc --with-mmseg --with-mmseg-includes=/usr/local/mmseg3/include/mmseg/ --with-mmseg-libs=/usr/local/mmseg3/lib/ --with-mysql

以上configure参数请正确拷贝，不要遗漏或者随意修改

make &amp;&amp; make install
</code></pre><h2 id="3-3-coreseek中文全文检索测试"><a href="#3-3-coreseek中文全文检索测试" class="headerlink" title="3.3  coreseek中文全文检索测试"></a>3.3  coreseek中文全文检索测试</h2><pre><code> cd testpack    

/usr/local/coreseek/bin/indexer -c etc/csft.conf
</code></pre><p>以下为正常情况下的提示信息：</p>
<pre><code> Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;etc/csft.conf&apos;...
total 0 reads, 0.000 sec, 0.0 kb/call avg, 0.0 msec/call avg
total 0 writes, 0.000 sec, 0.0 kb/call avg, 0.0 msec/call avg
</code></pre><p>csft-4.0版显示：ERROR: nothing to do.<br>提示：FATAL: failed to lock var/data/xml.spl: Resource temporarily unavailable, will not index. Try –rotate option.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/indexer -c etc/csft.conf --rotate</div></pre></td></tr></table></figure>
<pre><code>/usr/local/coreseek/bin/indexer -c etc/csft.conf --all
</code></pre><p>以下为正常索引全部数据时的提示信息：（csft-4.0版类似）</p>
<pre><code>Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]

opyright (c) 2007-2010,

Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;etc/csft.conf&apos;...
indexing index &apos;xml&apos;...
collected 3 docs, 0.0 MB
sorted 0.0 Mhits, 100.0% done
total 3 docs, 7585 bytes
total 0.075 sec, 101043 bytes/sec, 39.96 docs/sec
total 2 reads, 0.000 sec, 5.6 kb/call avg, 0.0 msec/call avg
total 7 writes, 0.000 sec, 3.9 kb/call avg, 0.0 msec/call avg 
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/indexer -c etc/csft.conf xml</div></pre></td></tr></table></figure>
<p>以下为正常索引指定数据时的提示信息：（csft-4.0版类似）</p>
<pre><code>    Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;etc/csft.conf&apos;...
indexing index &apos;xml&apos;...
collected 3 docs, 0.0 MB
sorted 0.0 Mhits, 100.0% done
total 3 docs, 7585 bytes
total 0.069 sec, 109614 bytes/sec, 43.35 docs/sec
total 2 reads, 0.000 sec, 5.6 kb/call avg, 0.0 msec/call avg
total 7 writes, 0.000 sec, 3.9 kb/call avg, 0.0 msec/call avg
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/search -c etc/csft.conf</div></pre></td></tr></table></figure>
<p>以下为正常测试搜索时的提示信息：（csft-4.0版类似）</p>
<pre><code>    Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;etc/csft.conf&apos;...
index &apos;xml&apos;: query &apos;&apos;: returned 3 matches of 3 total in 0.093 sec

displaying matches:
1. document=1, weight=1, published=Thu Apr  1 22:20:07 2010, author_id=1
2. document=2, weight=1, published=Thu Apr  1 23:25:48 2010, author_id=1
3. document=3, weight=1, published=Thu Apr  1 12:01:00 2010, author_id=2

words:
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/search -c etc/csft.conf -a Twittter和Opera都提供了搜索服务</div></pre></td></tr></table></figure>
<p>以下为正常测试搜索关键词时的提示信息：（csft-4.0版类似）</p>
<pre><code>    Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

 using config file &apos;etc/csft.conf&apos;...
index &apos;xml&apos;: query &apos;Twittter和Opera都提供了搜索服务 &apos;: returned 3 matches of 3 total in 0.038 sec

displaying matches:
1. document=3, weight=24, published=Thu Apr  1 12:01:00 2010, author_id=2
2. document=1, weight=4, published=Thu Apr  1 22:20:07 2010, author_id=1
3. document=2, weight=3, published=Thu Apr  1 23:25:48 2010, author_id=1

words:
1. &apos;twittter&apos;: 1 documents, 3 hits
2. &apos;和&apos;: 3 documents, 15 hits
3. &apos;opera&apos;: 1 documents, 25 hits
4. &apos;都&apos;: 2 documents, 4 hits
5. &apos;提供&apos;: 0 documents, 0 hits
6. &apos;了&apos;: 3 documents, 18 hits
7. &apos;搜索&apos;: 2 documents, 5 hits
8. &apos;服务&apos;: 1 documents, 1 hits
</code></pre><p>参考文档：<a href="http://www.coreseek.cn/products-install/install_on_bsd_linux/" target="_blank" rel="external">http://www.coreseek.cn/products-install/install_on_bsd_linux/</a></p>
<h2 id="4-1-配置文件"><a href="#4-1-配置文件" class="headerlink" title="4.1  配置文件"></a>4.1  配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/searchd -c etc/csft.conf</div></pre></td></tr></table></figure>
<p>以下为正常开启搜索服务时的提示信息：（csft-4.0版类似）</p>
<pre><code>    Coreseek Fulltext 3.2 [ Sphinx 0.9.9-release (r2117)]
Copyright (c) 2007-2010,
Beijing Choice Software Technologies Inc (http://www.coreseek.com)

using config file &apos;etc/csft.conf&apos;...
listening on all interfaces, port=9312
</code></pre><p>如要停止搜索服务，请使用</p>
<pre><code>/usr/local/coreseek/bin/searchd -c etc/csft.conf --stop
</code></pre><p>如要已启动服务，要更新索引，请使用</p>
<pre><code>/usr/local/coreseek/bin/indexer -c etc/csft.conf --all --rotate
</code></pre><h5 id="ERROR-index-‘xml’-failed-to-configure-some-of-the-sources-will-not-index-错误"><a href="#ERROR-index-‘xml’-failed-to-configure-some-of-the-sources-will-not-index-错误" class="headerlink" title="ERROR: index ‘xml’: failed to configure some of the sources, will not index.错误"></a>ERROR: index ‘xml’: failed to configure some of the sources, will not index.错误</h5><pre><code>yum install expat-devel
</code></pre><p>然后再重新编译coreseek，但执行make前记得先make clean下清除掉原先没有该依赖时编译生成的内容。     </p>
<h2 id="sphinx安装常见错误"><a href="#sphinx安装常见错误" class="headerlink" title="sphinx安装常见错误"></a>sphinx安装常见错误</h2><p>链接地址：<a href="http://blog.sina.com.cn/s/blog_998c49430101adv6.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_998c49430101adv6.html</a></p>
<h3 id="Linux操作系统下：mysql数据源配置：（对应coreseek-4-1-testpack-etc-csft-mysql-conf）"><a href="#Linux操作系统下：mysql数据源配置：（对应coreseek-4-1-testpack-etc-csft-mysql-conf）" class="headerlink" title="Linux操作系统下：mysql数据源配置：（对应coreseek-4.1/testpack/etc/csft_mysql.conf）"></a>Linux操作系统下：mysql数据源配置：（对应coreseek-4.1/testpack/etc/csft_mysql.conf）</h3><p>链接地址：<a href="http://www.coreseek.cn/products-install/mysql/" target="_blank" rel="external">http://www.coreseek.cn/products-install/mysql/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">#源定义</div><div class="line">source mysql</div><div class="line">&#123;</div><div class="line">    type                = mysql</div><div class="line"></div><div class="line">    sql_host                = localhost</div><div class="line">    sql_user                = root</div><div class="line">    sql_pass                =</div><div class="line">    sql_db                = test</div><div class="line">    sql_port                = 3306</div><div class="line">    sql_query_pre            = SET NAMES utf8</div><div class="line"></div><div class="line">    sql_query                = SELECT id, group_id, UNIX_TIMESTAMP(date_added) AS date_added, title, content FROM documents</div><div class="line">                                            #sql_query第一列id需为整数</div><div class="line">                                            #title、content作为字符串/文本字段，被全文索引</div><div class="line">    sql_attr_uint            = group_id            #从SQL读取到的值必须为整数</div><div class="line">    sql_attr_timestamp        = date_added      #从SQL读取到的值必须为整数，作为时间属性</div><div class="line"></div><div class="line">    sql_query_info_pre      = SET NAMES utf8                                        #命令行查询时，设置正确的字符集，3.2.14开始支持</div><div class="line">    sql_query_info            = SELECT * FROM documents WHERE id=$id  #命令行查询时，从数据库读取原始数据信息</div><div class="line">&#125;</div><div class="line"></div><div class="line">#index定义</div><div class="line">index mysql</div><div class="line">&#123;</div><div class="line">    source            = mysql             #对应的source名称</div><div class="line">    path            = var/data/mysql</div><div class="line">    docinfo            = extern</div><div class="line">    mlock            = 0</div><div class="line">    morphology        = none</div><div class="line">    min_word_len        = 1</div><div class="line">    html_strip                = 0</div><div class="line">    charset_dictpath = /usr/local/mmseg3/etc/    #BSD、Linux环境下设置，/符号结尾</div><div class="line">    #charset_dictpath = etc/                        #Windows环境下设置，/符号结尾</div><div class="line">    charset_type        = zh_cn.utf-8</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-2-在csft-mysql-conf增加增量索引配置"><a href="#4-2-在csft-mysql-conf增加增量索引配置" class="headerlink" title="4.2 在csft_mysql.conf增加增量索引配置"></a>4.2 在csft_mysql.conf增加增量索引配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#增加以下配置</div><div class="line">source delta : mysql #此写法为delta继承mysql源中的所有配置，如果子配置中有相同配置，则覆盖父配置</div><div class="line">&#123;</div><div class="line">        sql_query       =       SELECT id,fromid,toid,content FROM say WHERE id &gt; (SELECT max_offset FROM sph_say_counter WHERE id = 1) #从记录大于max_offset后的数据开始索引</div><div class="line">        sql_query_post  =       REPLACE INTO sph_say_counter(id,max_offset) SELECT 1,MAX(id) FROM say #索引后更新最大记录,sql_query_pre是执行查询前执行的语句，sql_query_post是执行查询后再执行的语句</div><div class="line">&#125;</div><div class="line">index delta : mysql</div><div class="line">&#123;</div><div class="line">        source          =       delta</div><div class="line">        path            =       /usr/local/coreseek/var/data/delta</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-1-建立索引"><a href="#5-1-建立索引" class="headerlink" title="5.1 建立索引"></a>5.1 建立索引</h2><p>调用命令列表：<br> 启动后台服务（必须开启）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/searchd -c /usr/local/coreseek/etc/csft_mysql.conf</div></pre></td></tr></table></figure>
<p> 执行索引（查询、测试前必须执行一次）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf --all --rotate</div></pre></td></tr></table></figure></p>
<p>执行增量索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf delta --rotate</div></pre></td></tr></table></figure>
<p>合并索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf --merge main delta --rotate --merge-dst-range deleted 0 0</div></pre></td></tr></table></figure>
<p>（为了防止多个关键字指向同一个文档加上–merge-dst-range deleted 0 0）</p>
<p>后台服务测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/search -c /usr/local/coreseek/etc/csft_mysql.conf  aaa</div></pre></td></tr></table></figure>
<p>关闭后台服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/coreseek/bin/searchd -c /usr/local/coreseek/etc/csft_mysql.conf --stop</div></pre></td></tr></table></figure>
<p>自动化命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crontab -e</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*/1 * * * * /bin/sh /usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf delta --rotate    </div><div class="line">*/5 * * * * /bin/sh /usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf --merge main delta --rotate --merge-dst-range deleted 0 0    </div><div class="line">30 1 * * *  /bin/sh /usr/local/coreseek/bin/indexer -c /usr/local/coreseek/etc/csft_mysql.conf --all --rotate</div></pre></td></tr></table></figure>
<p>以下任务计划的意思是：每隔一分钟执行一遍增量索引，每五分钟执行一遍合并索引，每天1:30执行整体索引。</p>
<h2 id="6-1-Sphinx扩展安装安装"><a href="#6-1-Sphinx扩展安装安装" class="headerlink" title="6.1 Sphinx扩展安装安装"></a>6.1 Sphinx扩展安装安装</h2><p>参考文献：<a href="http://blog.csdn.net/moqiang02/article/details/42027243" target="_blank" rel="external">http://blog.csdn.net/moqiang02/article/details/42027243</a></p>
<p>Coreseek官方教程中建议php使用直接include一个php文件进行操作，事实上php有独立的sphinx模块可以直接操作coreseek(coreseek就是sphinx！)已经进入了php的官方函数库，而且效率的提升不是一点点！但php模块依赖于libsphinxclient包。</p>
<h3 id="第一步-安装依赖libsphinxclient"><a href="#第一步-安装依赖libsphinxclient" class="headerlink" title="[第一步] 安装依赖libsphinxclient"></a>[第一步] 安装依赖libsphinxclient</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># cd /var/install/coreseek-4.1-beta/csft-4.1/api/libsphinxclient/    </div><div class="line"># ./configure  --prefix=/usr/local/sphinxclient    </div><div class="line">    </div><div class="line">configure: creating ./config.status    </div><div class="line">config.status: creating Makefile    </div><div class="line">config.status: error: cannot find input file: Makefile.in   #报错configure失败        </div><div class="line">    </div><div class="line">//处理configure报错    </div><div class="line">编译过程中报了一个config.status: error: cannot find input file: src/Makefile.in这个的错误，然后运行下列指令再次编译就能通过了：    </div><div class="line"># aclocal    </div><div class="line"># libtoolize --force    </div><div class="line"># automake --add-missing    </div><div class="line"># autoconf    </div><div class="line"># autoheader    </div><div class="line"># make clean    </div><div class="line">    </div><div class="line">//从新configure编译    </div><div class="line"># ./configure    </div><div class="line">    </div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="第二步-安装sphinx的PHP扩展"><a href="#第二步-安装sphinx的PHP扩展" class="headerlink" title="[第二步] 安装sphinx的PHP扩展"></a>[第二步] 安装sphinx的PHP扩展</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">http://pecl.php.net/package/sphinx    </div><div class="line"># wget http://pecl.php.net/get/sphinx-1.3.0.tgz    </div><div class="line"># tar zxvf sphinx-1.3.0.tgz    </div><div class="line"># cd sphinx-1.3.0    </div><div class="line"># phpize    </div><div class="line"># ./configure --with-php-config=/usr/bin/php-config --with-sphinx=/usr/local/sphinxclient    </div><div class="line"># make &amp;&amp; make install    </div><div class="line"># cd /etc/php.d/    </div><div class="line"># cp gd.ini  sphinx.ini    </div><div class="line"># vi sphinx.ini    </div><div class="line">    </div><div class="line">extension=sphinx.so    </div><div class="line">    </div><div class="line"># service php-fpm restart</div></pre></td></tr></table></figure>
<p>打开phpinfo看一下是否已经支持了sphinx模块。</p>
<h2 id="7-1-php调用sphinx示例："><a href="#7-1-php调用sphinx示例：" class="headerlink" title="7.1 php调用sphinx示例："></a>7.1 php调用sphinx示例：</h2><p>调用示例一：简单测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?php    </div><div class="line">    $s = new SphinxClient;    </div><div class="line">    $s-&gt;setServer(&quot;127.0.0.1&quot;, 9312);    </div><div class="line">    </div><div class="line">    $s-&gt;setMatchMode(SPH_MATCH_PHRASE);    </div><div class="line">    $s-&gt;setMaxQueryTime(30);    </div><div class="line">    $res = $s-&gt;query(&quot;宝马&quot;,&apos;main&apos;); #[宝马]关键字，[main]数据源source    </div><div class="line">    $err = $s-&gt;GetLastError();    </div><div class="line">    var_dump(array_keys($res[&apos;matches&apos;]));    </div><div class="line">    echo &quot;&lt;br&gt;&quot;.&quot;通过获取的ID来读取数据库中的值即可。&quot;.&quot;&lt;br&gt;&quot;;    </div><div class="line">        </div><div class="line">    echo &apos;&lt;pre&gt;&apos;;    </div><div class="line">    var_dump($res);    </div><div class="line">    var_dump($err);    </div><div class="line">    echo &apos;&lt;/pre&gt;&apos;;</div></pre></td></tr></table></figure>
<h3 id="调用示例二：支持分页"><a href="#调用示例二：支持分页" class="headerlink" title="调用示例二：支持分页"></a>调用示例二：支持分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">&lt;?php    </div><div class="line">    header(&quot;Content-type: text/html; charset=utf-8&quot;);    </div><div class="line">    require(&quot;./sphinxapi.php&quot;);    </div><div class="line">    $s = new SphinxClient;    </div><div class="line">    $s-&gt;setServer(&quot;192.168.252.132&quot;, 9312);    </div><div class="line">        </div><div class="line">    //SPH_MATCH_ALL, 匹配所有查询词(默认模式); SPH_MATCH_ANY, 匹配查询词中的任意一个; SPH_MATCH_EXTENDED2, 支持特殊运算符查询    </div><div class="line">    $s-&gt;setMatchMode(SPH_MATCH_ALL);    </div><div class="line">    $s-&gt;setMaxQueryTime(30);                             //设置最大搜索时间    </div><div class="line">    $s-&gt;SetArrayResult(false);                           //是否将Matches的key用ID代替    </div><div class="line">    $s-&gt;SetSelect ( &quot;*&quot; );                               //设置返回信息的内容,等同于SQL    </div><div class="line">    $s-&gt;SetRankingMode(SPH_RANK_BM25);                   //设置评分模式，SPH_RANK_BM25可能使包含多个词的查询的结果质量下降。     </div><div class="line">    //$s-&gt;SetSortMode(SPH_SORT_EXTENDED);                //发现增加此参数会使结果不准确    </div><div class="line">    //$s-&gt;SetSortMode(SPH_SORT_EXTENDED,&quot;from_id asc,id desc&quot;);  //设置匹配项的排序模式, SPH_SORT_EXTENDED按一种类似SQL的方式将列组合起来，升序或降序排列。    </div><div class="line">    $weights = array (&apos;company_name&apos; =&gt; 20);    </div><div class="line">    $s-&gt;SetFieldWeights($weights);                        //设置字段权重    </div><div class="line">    $s-&gt;SetLimits ( 0, 30, 1000, 0 );      //设置结果集偏移量  SetLimits (便宜量,匹配项数目,查询的结果集数默认1000,阀值达到后停止)    </div><div class="line">    //$s-&gt;SetFilter ( $attribute, $values, $exclude=false );     //设置属性过滤    </div><div class="line">    //$s-&gt;SetGroupBy ( $attribute, $func, $groupsort=&quot;@group desc&quot; );    //设置分组的属性    </div><div class="line">    $res = $s-&gt;query(&apos;@* &quot;汽车&quot;&apos;,&apos;main&apos;,&apos;--single-0-query--&apos;); #[宝马]关键字，[news]数据源source    </div><div class="line">        </div><div class="line">        </div><div class="line">    //代码高亮    </div><div class="line">    $tags = array();    </div><div class="line">    $tags_name = array();    </div><div class="line">    foreach($res[&apos;matches&apos;] as $key=&gt;$value)&#123;    </div><div class="line">        $tags[] = $value[&apos;attrs&apos;];    </div><div class="line">        $company_name[] = $value[&apos;attrs&apos;][&apos;company_name&apos;];    </div><div class="line">        $description[] = $value[&apos;attrs&apos;][&apos;description&apos;];    </div><div class="line">    &#125;    </div><div class="line">    $company_name = $s-&gt;BuildExcerpts ($company_name, &apos;main&apos;, &apos;汽车&apos;, $opts=array() );     //执行高亮，这里索引名字千万不能用*    </div><div class="line">    $description = $s-&gt;BuildExcerpts ($description, &apos;main&apos;, &apos;汽车&apos;, $opts=array() );       //执行高亮，这里索引名字千万不能用*    </div><div class="line">    foreach($tags as $k=&gt;$v)    </div><div class="line">    &#123;    </div><div class="line">        $tags[$k][&apos;company_name&apos;] = $company_name[$k];  //高亮后覆盖    </div><div class="line">        $tags[$k][&apos;description&apos;] = $description[$k];    //高亮后覆盖    </div><div class="line">    &#125;    </div><div class="line">        </div><div class="line">    // 高亮后覆盖    </div><div class="line">    $i = 0;    </div><div class="line">    foreach($res[&apos;matches&apos;] as $key=&gt;$value)&#123;    </div><div class="line">        $res[&apos;matches&apos;][$key] = $tags[$i];    </div><div class="line">        $i++;    </div><div class="line">    &#125;    </div><div class="line">        </div><div class="line">    $err = $s-&gt;GetLastError();    </div><div class="line">        </div><div class="line">    echo &apos;&lt;pre&gt;&apos;;    </div><div class="line">    var_export($res);    </div><div class="line">    var_export($err);    </div><div class="line">    echo &apos;&lt;/pre&gt;&apos;;</div></pre></td></tr></table></figure>
<hr>
<p>错误：FATAL: failedto lock pid file ‘/home/zhangjie_z.pt/local/sphinx/var/log/searchd.pid’:Resource temporarily unavailable (searchd already running?)<br>意思就是你已经打开了一个search进程，你需要找到相关进程号ps -e|grep searchd，然后kill PID杀死之前的进程，再启动新进程）</p>
<p>启动 searchd 服务时提示如下错误：<br>index ‘test1’: search error: failed to open /var/lib/sphinx/test1.sph: sphinx 错误解决 index ‘test1’: search error: failed to open /var/lib/sphinx/test.sph:No such file or directory; NOT SERVING<br>这个错误可能是没有建立好索引导致的，所以 indexer –all 很重要 </p>

  </article>
  <div class="random-toc-area">
  <button class="btn-hide-toc btn-hide-toc-show" style="display: none" onclick="TOCToggle()">显示目录</button>
  <button class="btn-hide-toc btn-hide-toc-hide" onclick="TOCToggle()">隐藏目录</button>
  <div class="random-toc">
    <h2>目录</h2>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#中文分词"><span class="toc-text">中文分词</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-什么是CoreSeek-Sphinx"><span class="toc-text">1.1. 什么是CoreSeek/Sphinx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-CoreSeek-Sphinx-的特性"><span class="toc-text">1.2. CoreSeek/Sphinx 的特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-为什么要使用Coreseek"><span class="toc-text">1.3  为什么要使用Coreseek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-那些地方适合使用Coreseek"><span class="toc-text">1.4  那些地方适合使用Coreseek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-国内全文检索的几个典型应用场景。"><span class="toc-text">1.5  国内全文检索的几个典型应用场景。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-哪些地方不适合Coreseek"><span class="toc-text">1.6  哪些地方不适合Coreseek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-Coreseek的局限性"><span class="toc-text">1.7  Coreseek的局限性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-如何得到CoreSeek-Sphinx"><span class="toc-text">2.1. 如何得到CoreSeek/Sphinx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-去-官网-下载coreseek源码包，本文以-4-1为例"><span class="toc-text">2.2 去 官网 下载coreseek源码包，本文以 4.1为例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-然后安装coreseek"><span class="toc-text">2.3  然后安装coreseek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-安装mmseg"><span class="toc-text">2.4  安装mmseg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh-CN-UTF-8，确保正确显示中文）"><span class="toc-text">2.5  测试mmseg分词，coreseek搜索（需要预先设置好字符集为zh_CN.UTF-8，确保正确显示中文）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-配置测试，测试是否可以正确运行"><span class="toc-text">3.1 配置测试，测试是否可以正确运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-重新编译安装coreseek，以支持mysql数据源和xml数据源"><span class="toc-text">3.2  重新编译安装coreseek，以支持mysql数据源和xml数据源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-coreseek中文全文检索测试"><span class="toc-text">3.3  coreseek中文全文检索测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-配置文件"><span class="toc-text">4.1  配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ERROR-index-‘xml’-failed-to-configure-some-of-the-sources-will-not-index-错误"><span class="toc-text">ERROR: index ‘xml’: failed to configure some of the sources, will not index.错误</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sphinx安装常见错误"><span class="toc-text">sphinx安装常见错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux操作系统下：mysql数据源配置：（对应coreseek-4-1-testpack-etc-csft-mysql-conf）"><span class="toc-text">Linux操作系统下：mysql数据源配置：（对应coreseek-4.1/testpack/etc/csft_mysql.conf）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-在csft-mysql-conf增加增量索引配置"><span class="toc-text">4.2 在csft_mysql.conf增加增量索引配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-建立索引"><span class="toc-text">5.1 建立索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-Sphinx扩展安装安装"><span class="toc-text">6.1 Sphinx扩展安装安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步-安装依赖libsphinxclient"><span class="toc-text">[第一步] 安装依赖libsphinxclient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步-安装sphinx的PHP扩展"><span class="toc-text">[第二步] 安装sphinx的PHP扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-php调用sphinx示例："><span class="toc-text">7.1 php调用sphinx示例：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#调用示例二：支持分页"><span class="toc-text">调用示例二：支持分页</span></a></li></ol></li></ol></li></ol>
  </div>
</div>

  
<nav id="pagination">
  
    <a href="/2016/04/03/code-phpstorm/" class="prev">&larr; 上一篇 Phpstorm 激活</a>
  

  

  
    <a href="/2017/04/20/rwseparate/" class="next">下一篇 框架中读写分离的实现 &rarr;</a>
  
</nav>

  <!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


      
      
      
    </div>
  </div>

  <div id="bottom-outer">
    <div id="bottom-inner">
      Site by  using
      <a href="http://hexo.io">Hexo</a> & <a href="https://github.com/stiekel/hexo-theme-random">Random</a>
      <br>
      
    </div>
  </div>
</div>

</div>



<div id="user-card">
  <div class="center-field">
    <img class="avatar" src="http://om34v8mq1.bkt.clouddn.com/head.png">
    <p id="description">when you believe</p>
    <ul class="social-icon">
  
  
    <li>
      <a href="https://www.zhihu.com/people/zhou-wen-85-39">
        
          <i class="icon iconfont zhihu">&#xe60b;</i>
        
      </a>
    </li>
  
    <li>
      <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=_JuQl5afycHBzMjAyM64jpGI1omJ1puXlQ">
        
          Mail
        
      </a>
    </li>
  
    <li>
      <a href="http://weibo.com/u/3277953551">
        
          <i class="icon iconfont weibo">&#xe602;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://github.com/stiekel/hexo-theme-random">
        
          <i class="icon iconfont github">&#xe606;</i>
        
      </a>
    </li>
  
</ul>
  </div>
</div>


<div id="btn-view">Hide</div>

<script>
// is trigger analytics / tongji script
var isIgnoreHost = false;

if(window && window.location && window.location.host) {
  isIgnoreHost = ["localhost","127.0.0.1"].some(function(address){
    return 0 === window.location.host.indexOf(address);
  });
}

var isTriggerAnalytics = !( true && isIgnoreHost );

</script>




  
  
    <script src="/js/jquery-2.2.3.min.js"></script>
  
    <script src="/js/vegas.min.js"></script>
  
    <script src="/js/random.js"></script>
  
    <script src="/js/highlight.pack.js"></script>
  
    <script src="/js/jquery.mousewheel.pack.js"></script>
  
    <script src="/js/jquery.fancybox.pack.js"></script>
  
    <script src="/js/jquery.fancybox-thumbs.js"></script>
  
    <script src="/js/plyr.js"></script>
  

<script>

  // fancybox
  var backgroundImages = [];
  
  $('#post').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('fancybox-thumb')) return;
      var alt = this.alt || this.title;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'post' + i);
    });
  });
  $(".fancybox").fancybox();

var vegasConfig = {"preload­Image":true,"transition":["slideLeft2","slideRight2","flash","flash2"],"timer":true,"delay":8000,"shuffle":true,"count":88};
var unsplashConfig = {"gravity":"north"};
// is show background images
var turnoffBackgroundImage = false;




var backgroundColor = "34495E";

$(".fancybox-thumb").fancybox({
  prevEffect: 'none',
  nextEffect: 'none',
  helpers: {
    title: {
      type: 'outside'
    },
    thumbs: {
      width: 50,
      height: 50
    }
  }
});

// show video with plyr
$(".video-container iframe").each(function(i){
  var url = $(this).attr('src');
  var id = url.split('/').pop();
  var plyrContainer = document.createElement('div');
  plyrContainer.className = 'plyr';
  var plyrElement = document.createElement('div');
  plyrElement.dataset.videoId = id;
  switch(true) {
    case url.search('youtube.com') >= 0:
      plyrElement.dataset.type = 'youtube';
      break;
    case url.search('vimeo.com') >= 0:
      plyrElement.dataset.type = 'vimeo';
      break;
    default:
      return;
  };
  plyrContainer.appendChild(plyrElement);
  $(this).parent().html(plyrContainer);
});
plyr.setup('.plyr', {iconUrl: '/css/sprite.svg'});
</script>
</body>
</html>

